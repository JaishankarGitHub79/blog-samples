package service;

import java.net.URL;
import org.junit.AfterClass;
import org.junit.BeforeClass;

import org.apache.catalina.Context;
import org.apache.catalina.Engine;
import org.apache.catalina.Host;
import org.apache.catalina.connector.Connector;
import org.apache.catalina.startup.Embedded;
import org.apache.catalina.realm.MemoryRealm;

/* To test with Tomcat instead of Jetty:
   rename this file to EmbeddedTomcatIT.java
   change extension of EmbeddedJettyIT.java to .txt
   switch from the Jetty to Tomcat dependencies in war/pom.xml
*/
public class EmbeddedTomcatIT extends DoubleItPortTypeImplTest {
   protected static Embedded server;
   protected static String address;

   @BeforeClass
   public static void setUp() throws Exception {
      address = "http://localhost:9001/doubleit/services/doubleit";
      wsdlURL = new URL(address + "?wsdl");

      server = new Embedded();
      // server.setRealm(new MemoryRealm()); // if using the tomcat-users.xml
      // file.
      Engine baseEngine = server.createEngine();
      baseEngine.setDefaultHost("doubleItHost");
      Host baseHost = server.createHost("doubleItHost",
            "/data/workspace/blog-samples/junit_web_service_testing/war/target");
      baseEngine.addChild(baseHost);
      Context appCtx = server.createContext("/doubleit", "doubleit");
      baseHost.addChild(appCtx);
      server.addEngine(baseEngine);
      Connector httpConnector = server.createConnector(
            (java.net.InetAddress) null, 9001, false);
      server.addConnector(httpConnector);

      try {
         server.start();
      } catch (Exception e) {
         e.printStackTrace();
      }
   }

   @AfterClass
   public static void tearDown() throws Exception {
      if (server != null) {
         server.stop();
         server = null;
      }
   }
}

